#!/bin/sh
# SafeRun post-checkout hook
# Protects against dangerous AI agent operations

# Bypass for CI or explicit disable
if [ "$SAFERUN_DISABLE" = "1" ] || [ "$CI" = "true" ] || [ "$CI" = "1" ]; then
  exit 0
fi

# Expand PATH to handle edge cases (osascript, minimal shells, etc.)
export PATH="/usr/local/bin:/opt/homebrew/bin:/usr/bin:/bin:$HOME/.nvm/versions/node/current/bin:$HOME/.npm-global/bin:$PATH"

# Check if npx is available
if ! command -v npx >/dev/null 2>&1; then
  echo "⚠️  SafeRun: npx not found. Install Node.js or ensure it's in PATH."
  echo "Bypassing SafeRun protection for this operation..."
  exit 0  # graceful degradation
fi

# Run SafeRun hook
npx --no saferun-hook post-checkout "$@"
exit $?
